# Smart Reply for Gmail

Gmail のスレッド内容からコンテキストを抽出し、クラウド LLM に投げて返信文の候補を取得する Chrome 拡張機能です。ユーザー自身の API キーを安全に保存し、OpenAI 互換のエンドポイントに問い合わせて複数案を生成します。

## 特長
- Gmail の返信エディタ付近に Smart Reply ボタンを表示し、クリックしたタイミングで返信案を生成
- 最新のメッセージ本文を LLM に渡し、丁寧な返信案を複数取得
- 日本語と英語を簡易判定して、適切な言語で提案
- 候補をクリックすると返信エディタへ自動挿入
  - 拡張機能のポップアップから API キー／モデル／エンドポイントを設定可能

## 使い方
1. このリポジトリをクローンまたはダウンロードして任意のフォルダに展開します。
2. Chrome で `chrome://extensions` を開き、右上の「デベロッパーモード」をオンにします。
3. 「パッケージ化されていない拡張機能を読み込む」を押して、このリポジトリのルートディレクトリを選択します。
4. 拡張機能のツールバーアイコンをクリックし、ポップアップから API キーやモデル名、エンドポイント（OpenAI 互換）を保存します。
5. Gmail を開き、返信エディタにカーソルを置くと Smart Reply ボタンがエディタ付近に表示されます。
6. ボタンをクリックすると AI リクエストが送信され、ダイアログに返信案が並びます。候補をクリックすると返信エリアに文章が挿入されます。不要な場合はパネルの “×” で一時的に非表示にできます。

## ファイル構成
- `manifest.json` — Chrome 拡張機能のマニフェスト設定
- `src/background.js` — API キーを読み出して LLM に問い合わせるバックグラウンドサービスワーカー
- `src/content-script.js` — Gmail 上で DOM を監視し、バックグラウンド経由で候補を取得するコンテンツスクリプト
- `src/popup.html` / `src/popup.js` — API キーやモデル等を保存するポップアップ UI
- `src/styles.css` — サジェストパネルのスタイル定義
- `.gitignore` — 無視するファイル/ディレクトリの定義

## 仕組みの概要
1. Gmail の DOM を監視し、返信用のエディタ (`div[aria-label="Message Body"]`) にフォーカスが当たったことを検知します。
2. スレッド内の最新メッセージから引用部分を除外したテキストを抽出します。
3. 言語を判定し、バックグラウンドサービスワーカーに対してコンテキストとともに LLM への問い合わせを依頼します。
4. LLM から受け取った複数案をサジェストパネルに表示し、クリックで `document.execCommand('insertText')` を通じてエディタに挿入します。

## 留意点
- OpenAI 互換のエンドポイント向けに設計しているため、別のプロバイダを利用する場合はエンドポイントやリクエスト形式を調整してください。
- API キーは `chrome.storage.sync` に保存されるため、複数端末で同期させたくない場合は Chrome の同期設定に注意してください。
- DOM 構造が大きく変わった場合は、コンテキスト抽出ロジックの調整が必要になる可能性があります。
